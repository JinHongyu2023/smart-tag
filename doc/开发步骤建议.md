## ✅ 阶段一：技术准备与原型构建

### Step 1：生成插件项目基础结构
- 创建插件基础目录结构（`manifest.json`、`main.ts`、`settings.ts` 等）；
- 注册命令（如“智能打标签”）、设置页面板；
- 确保插件可以在 Obsidian 插件管理中识别并运行（基础插件框架完成）。

➡️ 我可以为你生成完整的插件框架模板，适合直接放入 Obsidian 的插件目录启动开发。

---

### Step 2：设计 LLM 请求格式与接口封装
- 定义调用 LLM 的请求体（兼容 OpenAI chat 接口格式）；
- 添加接口测试逻辑；
- 封装为独立函数：支持输入 prompt 和返回推荐标签。

➡️ 我可以为你输出一份 `LLMService.ts` 的代码模块，专门用于调用和测试。

---

### Step 3：构建设置界面（Settings Tab）
- 创建设置 UI，包括：
  - API Key 输入框
  - Endpoint、模型名称、推荐数量等字段
  - “测试配置”按钮
  - 领域标签的增删控件
- 测试保存与读取设置项功能正常

➡️ 我可以为你生成 `settings.tsx` 的设置界面代码。

---

## ✅ 阶段二：推荐标签功能开发

### Step 4：接入当前笔记内容
- 获取当前激活笔记的文本；
- 分析内容作为 prompt 输入 LLM；
- 接收 LLM 返回的标签列表（3~5 个）

### Step 5：标签确认与编辑弹窗
- 构建弹窗 UI：
  - 推荐标签复选框
  - 可修改推荐结果
  - 下拉选择领域标签
  - “确认写入标签”按钮

➡️ 我可以为你设计一个轻量弹窗模块，或者使用 Obsidian 的 `Modal` 类快速构建。

---

## ✅ 阶段三：标签写入 + 历史记录

### Step 6：写入标签到 YAML Frontmatter
- 若已存在 `tags` 字段，合并/替换；
- 避免重复、保持格式；
- 插入格式统一为：
  ```yaml
  tags:
    - 领域标签
    - 领域标签/推荐标签1
    - 领域标签/推荐标签2
  ```

### Step 7：记录推荐历史
- 将推荐结果写入本地 JSON 文件，结构如：
  ```json
  {
    "notePath": "xxx.md",
    "field": "修行",
    "tags": ["六度万行", "止观入门"],
    "timestamp": "2025-04-09T10:21:00"
  }
  ```

---

## ✅ 阶段四：优化与发布

### Step 8：优化体验
- 增加推荐标签稳定性处理逻辑；
- 建立推荐标签缓存（提升一致性）；
- 支持快捷键触发、命令面板操作；

### Step 9：打包插件 & 本地测试
- 使用 Rollup 或官方打包脚本打包插件；
- 手动安装 `.obsidian/plugins/smart-tag` 进行测试；
- 调整 UI 或逻辑细节；

---

## 🚀 阶段五：发布与迭代（可选）

- 将插件提交至 Obsidian 官方社区（或仅私用）；
- 后续开发批量标签处理、知识图谱联动等增强功能；
- 或接入你未来的个人知识库生态系统中（如你提到的“第二大脑”结构）。

---

### ✅ 建议你现在选择：

1. **我先帮你生成插件项目框架（可直接运行）？**
2. **还是先输出调用 LLM 的接口模块（含测试功能）？**
3. **或者我们先搭建设置界面？**

你只要说：“我们先从 XX 开始”，我就马上安排 👇