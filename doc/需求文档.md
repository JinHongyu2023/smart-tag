
# 🧠 Obsidian SmartTag 插件开发需求说明书  
插件名称建议：**SmartTag 智能标签助手**

---

## 一、项目背景

用户在使用 Obsidian 做知识管理时，希望搭建一套“结构化、高质量”的标签系统。为此，需要一个插件能结合大语言模型（LLM），根据笔记内容智能推荐标签，并统一格式写入笔记，便于构建笔记之间的**知识网络与知识图谱**。

---

## 二、插件目标

- 接入兼容 OpenAI 格式的 LLM 接口，分析当前笔记内容；
- 推荐 3-5 个“智能标签”供用户选择、编辑并确认；
- 每篇笔记由一个**预设“领域标签”** + 多个**“LLM 推荐标签”**组成；
- 最终统一写入笔记的 YAML Frontmatter 中；
- 推荐过程可记录历史并保持标签稳定性；
- 标签体系支持中英文混合内容，**但标签以中文为主**；
- 插件支持用户检测 LLM 配置是否正确。

---

## 三、功能模块

### 1. LLM 推荐标签模块
- 用户配置 OpenAI 接口（API Key、Endpoint、模型名称）；
- 调用 LLM 接口分析当前笔记全文；
- 生成 3-5 个语义相关、稳定可复用的推荐标签；
- 推荐标签支持用户 **复选、编辑、删除**；
- 插件应避免生成语义重复或粒度混乱的标签。

### 2. 领域标签管理模块
- 插件设置中添加领域标签（如：修行、商业、AI、健康等）；
- 每篇笔记只能选择一个领域标签；
- 可设置默认领域标签；
- 所有推荐标签将按结构 `领域标签/智能标签` 写入。

### 3. 标签写入模块
- 标签统一写入笔记的 YAML Frontmatter 中的 `tags` 字段；
- 写入结构如下：

```yaml
tags:
  - 修行
  - 修行/六度万行
  - 修行/止观入门
```

说明：
- 第一项为领域标签；
- 其余为“领域标签/推荐标签”结构；
- 插件避免重复写入，保留一致性；
- 支持配置“是否覆盖旧推荐标签”。

### 4. 标签稳定性与历史记录
- 插件应尽可能让推荐标签“语义稳定”，避免相似内容生成不同标签；
- 历史推荐记录将本地缓存，提升未来推荐一致性；
- 缓存文件结构建议为 JSON，包含推荐时间、标签、所属领域等；
- 存储路径默认：`.obsidian/plugins/smart-tag/history.json`。

### 5. 多语言支持
- 插件支持多语言内容分析；
- 推荐标签以中文为主，但可包含关键术语英文词（如：Obsidian、Markdown）；
- 支持输出中英文混合标签，例如：

```yaml
tags:
  - AI
  - AI/Obsidian插件
  - AI/Prompt设计
```

---

## 四、界面设计

### 插件设置页（Plugin Settings）

| 配置项 | 功能说明 |
|--------|----------|
| ✅ API Key | 用户输入 OpenAI 密钥 |
| ✅ LLM Endpoint | 如：`https://api.openai.com/v1/chat/completions` |
| ✅ 模型名称 | 如：`gpt-3.5-turbo`、`deepseek-chat` |
| ✅ 推荐标签数量 | 默认 5，用户可设定范围（2~8） |
| ✅ 管理领域标签 | 添加、删除、排序，支持设默认值 |
| ✅ 是否自动覆盖旧推荐标签 | 开关，决定是否替换之前标签 |
| ✅ 历史记录路径 | 默认保存为 `.obsidian/plugins/smart-tag/history.json` |
| ✅ **一键检测 LLM 配置按钮** | 发送测试请求检查接口有效性，显示配置是否成功 |

#### 配置检测逻辑说明：
- 用户点击“测试 LLM 配置”按钮；
- 插件向已配置接口发送测试请求（如 prompt：“你好”）；
- 显示接口连接状态、响应时长、是否返回正常数据；
- 配置正确时提示：“配置成功，可正常调用模型”。

---

### 插件使用面板（命令调用或右栏激活）

- 显示当前笔记摘要（可选）；
- 下拉选择当前笔记的“领域标签”；
- 展示 LLM 推荐标签列表（带复选框，可编辑）；
- “写入标签”按钮；
- 写入成功提示；
- 近期历史推荐标签（可选）预览。

---

## 五、技术实现说明

| 模块 | 技术说明 |
|------|----------|
| LLM 接口 | 兼容 OpenAI 格式的 chat/completions 接口 |
| 编辑 UI | 使用 Obsidian 插件 API 创建设置页和命令 |
| 标签写入 | 修改当前笔记 YAML Frontmatter 的 `tags` 字段 |
| 历史记录 | JSON 存储：每条记录包含笔记路径、领域、标签数组、时间戳等 |
| 标签格式 | 遵循 `领域标签/推荐标签`，不允许特殊字符与空格 |
| 多语言兼容 | 只需支持中文推荐，内容可含中英文混合输入 |
| 插件触发 | 支持命令菜单激活、快捷键、自定义按钮等方式触发推荐流程 |

---

## 六、工作流程示意

1. 用户打开一篇笔记；
2. 启动“智能标签推荐”命令；
3. 选择当前领域标签（如“修行”）；
4. 插件分析内容并生成推荐标签（如：“六度万行”、“止观入门”）；
5. 用户可勾选、修改、删除标签；
6. 插件将以下结构写入笔记：

```yaml
tags:
  - 修行
  - 修行/六度万行
  - 修行/止观入门
```

7. 本次推荐记录保存在历史文件中，便于未来增强推荐稳定性。

---

## 七、可扩展方向（非本阶段必需）

- [ ] 支持批量为多篇笔记推荐与写入标签；
- [ ] 支持可视化标签网络图谱；
- [ ] 支持标签库自定义权重、别名映射等；
- [ ] 与 Dataview、Graph View 等插件联动；
- [ ] 自动补全输入标签建议（如“修”提示“修行/六度万行”）；

---

✅ 以上即为插件的完整需求说明书，如果你确认无误，我们就可以继续输出技术接口文档（如 LLM 请求结构、插件目录结构等），或者直接搭建初始代码框架。  
请确认是否还有需要补充或修改的内容？